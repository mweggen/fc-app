<link rel="import" href="../bower_components/polymer/polymer-element.html">

<dom-module id="fc-create-slave-data">
  <script>
    class FCCreateSlaveData extends Polymer.Element {
      static get is() {
        return "fc-create-slave-data";
      }

      static get properties() {
        return {
          continents: {
            type: Object,
            value: {
              'North America': {
                'supremacistRace': 'white',
                'subjugationistRace': 'black',
                'nationalities': [{
                  name: 'American',
                  races: [{
                    name: 'white',
                    weight: 3
                  }, {
                    name: 'black',
                    weight: 1
                  }, {
                    name: 'middle eastern',
                    weight: 1
                  }, {
                    name: 'latina',
                    weight: 2
                  }, {
                    name: 'asian',
                    weight: 1
                  }, {
                    name: 'amerindian',
                    weight: 1
                  }, {
                    name: 'mixed race',
                    weight: 1
                  }],
                  weight: 4
                }, {
                  name: 'Mexican',
                  races: [{
                    name: 'latina',
                    weight: 5
                  }, {
                    name: 'amerindian',
                    weight: 1
                  }],
                  weight: 2
                }, {
                  name: 'Haitian',
                  races: [{
                    name: 'black',
                    weight: 1
                  }],
                  weight: 1
                }, {
                  name: 'Cuban',
                  races: [{
                    name: 'latina',
                    weight: '1'
                  }],
                  weight: 1
                }, {
                  name: 'Puerto Rican',
                  races: [{
                    name: 'latina',
                    weight: 1
                  }],
                  weight: 1
                }, {
                  name: 'Jamaican',
                  races: [{
                    name: 'black',
                    weight: 1
                  }],
                  weight: 1
                }, {
                  name: 'Guatemalan',
                  races: [{
                    name: 'latina',
                    weight: 1
                  }, {
                    name: 'amerindian',
                    weight: 1
                  }],
                  weight: 1
                }, {
                  name: 'Bermudian',
                  races: [{
                    name: 'black',
                    weight: 3
                  }, {
                    name: 'white',
                    weight: 1
                  }],
                  weight: 1
                }, {
                  name: 'Greenlandic',
                  races: [{
                    name: 'amerindian',
                    weight: 9
                  }, {
                    name: 'white',
                    weight: 1
                  }],
                  weight: 1
                }, {
                  name: 'Belizean',
                  races: [{
                    name: 'latina',
                    weight: 4
                  }, {
                    name: 'black',
                    weight: 2
                  }, {
                    name: 'amerindian',
                    weight: 1
                  }, {
                    name: 'white',
                    weight: 1
                  }],
                  weight: 1
                }, {
                  name: 'Grenadian',
                  races: [{
                    name: 'black',
                    weight: 9
                  }, {
                    name: 'mixed race',
                    weight: 1
                  }],
                  weight: 1
                }, {
                  name: 'Honduran',
                  races: [{
                    name: 'latina',
                    weight: 9
                  }, {
                    name: 'amerindian',
                    weight: 1
                  }],
                  weight: 1
                }, {
                  name: 'Costa Rican',
                  races: [{
                    name: 'latina',
                    weight: 4
                  }, {
                    name: 'white',
                    weight: 1
                  }],
                  weight: 1
                }, {
                  name: 'Salvadoran',
                  races: [{
                    name: 'latina',
                    weight: 5
                  }, {
                    name: 'white',
                    weight: 1
                  }],
                  weight: 1
                }, {
                  name: 'Nicaraguan',
                  races: [{
                    name: 'latina',
                    weight: 6
                  }, {
                    name: 'white',
                    weight: 2
                  }, {
                    name: 'black',
                    weight: 1
                  }],
                  weight: 1
                }, {
                  name: 'Panamanian',
                  races: [{
                    name: 'latina',
                    weight: 6
                  }, {
                    name: 'white',
                    weight: 1
                  }, {
                    name: 'black',
                    weight: 1
                  }, {
                    name: 'amerindian',
                    weight: 1
                  }, {
                    name: 'mixed race',
                    weight: 1
                  }],
                  weight: 1
                }]
              },
              'South America': {
                'supremacistRace': 'latina',
                'subjugationistRace': 'black',
                'nationalities': [{
                  name: 'Brazilian',
                  weight: 4
                }, {
                  name: 'Argentinian',
                  weight: 2
                }, {
                  name: 'Colombian',
                  weight: 2
                }, {
                  name: 'Peruvian',
                  weight: 1
                }, {
                  name: 'Venezuelan',
                  weight: 1
                }, {
                  name: 'Bolivian',
                  weight: 1
                }, {
                  name: 'Chilean',
                  weight: 1
                }, {
                  name: 'Uruguayan',
                  weight: 1
                }]
              }
            },
            notify: true

          }
        }
      }

      createSlave() {
        let slave = {
          devotion: 0,
          trust: 0,
          indenture: -1,
          voice: 2,
          birthWeek: 0,
          age: this.randomizeAge(),
          health: this._normalRandClampedInt(50),
          eyes: 0,
          intelligence: this._normalRandClampedInt(3),
          intelligenceImplant: 0,
          eyeColor: 'hazel',
          muscles: 0,
          height: Math.floor(this._normalRand() * 7.11 + 162.6),
          weight: this._normalRandClampedInt(100),
          boobsImplant: 0
        };

        if (Math.random() < 0.5 + 0.2 * slave.intelligence) {
          slave.intelligenceImplant = 1;
        }
        if (slave.age / 100 > Math.random()) {
          slave.eyes = -1;
        }
        if (slave.weight < -30) {
          slave.waist = this._normalRandClampedInt(28) - 28;
        } else if (slave.weight <= 30) {
          slave.waist = this._normalRandClampedInt(45);
        } else {
          slave.waist = this._normalRandClampedInt(28) + 28;
        }
        slave.nationality = this.weightedRandom(this.continents['North America'].nationalities).name;
        slave.race = this.weightedRandom(this.continents['North America'].nationalities
            .find(n => n.name === slave.nationality).races).name;

        slave.eyeColor = 'brown';
        slave.hStyle = 'neat';
        if (slave.race === 'black') {
          slave.butt = this._randomElement([1, 2, 2, 3, 3, 4, 4]);
          slave.boobs = this._randomBoobVolume(150);
          slave.lips = this._normalRandClampedInt(18) + 23;
          slave.skin = this._randomElement(['black', 'brown', 'light brown']);
          slave.hColor = this._randomElement(['black', 'black', 'black', 'brown']);
          slave.hStyle = this._randomElement(['neat', 'crinkled']);
        } else if (slave.race === 'white') {
          slave.butt = this._randomElement([1, 2, 2, 3, 3, 4]);
          slave.boobs = this._randomBoobVolume(50);
          slave.lips = this._normalRandClampedInt(10) + 15;
          // todo specific nationalities
          slave.skin = this._randomElement(['pale', 'tanned', 'fair']);
          slave.eyeColor = this._randomElement(['blue', 'brown', 'green']);
          slave.hColor = this._randomElement(['black', 'blonde', 'red', 'brown']);
        } else if (slave.race === 'latina') {
          slave.butt = this._randomElement([1, 2, 2, 3, 3, 4]);
          slave.boobs = this._randomBoobVolume(0);
          slave.lips = this._normalRandClampedInt(10) + 15;
          slave.skin = this._randomElement(['olive', 'brown', 'light brown']);
          slave.hColor = this._randomElement(['black', 'black', 'brown', 'brown']);
        } else if (slave.race === 'indo-aryan' || slave.race === 'malay'
            || slave.race === 'pacific islander' || slave.race === 'amerindian') {
          slave.butt = this._randomElement([1, 2, 2, 3, 3]);
          slave.boobs = this._randomBoobVolume(0);
          slave.lips = this._normalRandClampedInt(10) + 15;
          slave.skin = this._randomElement(['dark', 'light']);
          slave.hColor = this._randomElement(['black']);
        } else if (slave.race === 'asian') {
          slave.butt = this._randomElement([1, 2, 2, 3, 3]);
          slave.boobs = this._randomBoobVolume(-100);
          slave.lips = this._normalRandClampedInt(10) + 15;
          slave.skin = this._randomElement(['pale', 'dark', 'light']);
          slave.hColor = this._randomElement(['black']);
        } else if (slave.race === 'middle eastern' || slave.race === 'semitic' || slave.race === 'southern european') {
          slave.butt = this._randomElement([1, 2, 2, 3, 3]);
          slave.boobs = this._randomBoobVolume(0);
          slave.lips = this._normalRandClampedInt(10) + 15;
          slave.skin = this._randomElement(['pale', 'dark', 'light']);
          slave.hColor = this._randomElement(['black']);
        } else {
          slave.butt = this._randomElement([1, 2, 2, 3, 3, 4]);
          slave.boobs = this._randomBoobVolume(0);
          slave.lips = this._normalRandClampedInt(10) + 15;
          slave.skin = this._randomElement(['pale', 'dark', 'light']);
          slave.hColor = this._randomElement(['black', 'black', 'black', 'black', 'brown', 'brown', 'blonde', 'red']);
        }

        if (slave.skin === 'pale' || slave.skin === 'fair') {
          if (Math.random() < 0.25) {
            slave.markings = this._randomElement(['freckles', 'freckles', 'freckles', 'heavily freckled',
                'beauty mark', 'beauty mark', 'birthmark', 'birthmark']);
          }
        } else if (Math.random() < 0.125) {
          slave.markings = this._randomElement(['beauty mark', 'birthmark']);
        } else {
          slave.markings = '';
        }

        let shapes = [];
        slave.boobShape = '';
        if (slave.boobs > 250 && slave.boobs < 800) {
          shapes.push('perky', 'downward-facing');
        }
        if (slave.boobs > 400 && slave.boobs < 1200) {
          shapes.push('torpedo-shaped', 'wide-set');
        }
        if (slave.boobs > 800 && slave.age > Math.floor(Math.random() * 41) + 10) {
          shapes.push('saggy');
        }
        if (shapes.length === 1) {
          if (Math.random() < 0.5) {
            slave.boobShape = shapes[0];
          }
        } else if (shapes.length > 1) {
          if (Math.random() * 3 < 1) {
            slave.boobShape = this._randomElement(shapes);
          }
        }

        slave.birthName = this.randomName(slave);
        slave.birthSurname = this.randomizeSurname(slave);
        if (slave.height >= 169) {
          slave.hips = this._randomElement([-1, 0, 0, 1, 1, 2, 2]);
          slave.shoulders = this._randomElement([-1, -1, 0, 0, 0, 1])
        } else {
          slave.hips = this._randomElement([-1, 0, 0, 0, 1, 1, 2]);
          slave.shoulders = this._randomElement([-2, -1, -1, 0, 0, 1])
        }

        console.info(slave);
        return slave;
      }

      weightedRandom(array) {
        let total = array.map(i => i.weight).reduce((x, y) => x + y);
        let sum = 0, r = Math.random() * total;
        for (let i = 0; i < array.length; i++) {
          let item = array[i];
          sum += item.weight;
          if (r <= sum) {
            return item;
          }
        }
        return array[array.length-1];
      }

      randomName(slave) {
        let names = ["Abigail", "Adalyn", "Addison", "Adeline", "Alaina", "Alexandra", "Alicia", "Allison", "Alyssa", "Amanda", "Amber", "Amelia", "Amy", "Andrea", "Angela", "Anna", "Annabelle", "Anne", "April", "Aria", "Arianna", "Ashley", "Aubrey", "Audrey", "Ava", "Avery", "Bailey", "Bethany", "Brandi", "Brandy", "Brittany", "Brittney", "Brooke", "Brooklyn", "Caitlin", "Callie", "Candice", "Caroline", "Carrie", "Cassandra", "Catherine", "Charlotte", "Chelsea", "Chloe", "Christina", "Christine", "Claire", "Clover", "Courtney", "Crystal", "Cynthia", "Dana", "Danielle", "Diana", "Elena", "Eliana", "Elizabeth", "Ella", "Ellie", "Emily", "Emma", "Erica", "Erika", "Erin", "Eva", "Evelyn", "Gabriella", "Grace", "Hailey", "Hannah", "Harper", "Heather", "Holly", "Isabella", "Isabelle", "Jacqueline", "Jade", "Jamie", "Jane", "Jasmine", "Jenna", "Jennifer", "Jenny", "Jessica", "Joan", "Julia", "Julie", "June", "Kaitlyn", "Karen", "Kate", "Katherine", "Kathleen", "Kathryn", "Katie", "Kayla", "Kaylee", "Keira", "Kelly", "Kennedy", "Kimberly", "Kristen", "Kristin", "Kristina", "Krystal", "Kylie", "Latoya", "Laura", "Lauren", "Laurie", "Layla", "Leah", "Leslie", "Lila", "Liliana", "Lillian", "Lily", "Lindsay", "Lindsey", "Lisa", "Lois", "Lucy", "Mackenzie", "Madelyn", "Madison", "Makayla", "Mandy", "Margaret", "Maria", "Mary", "Maya", "Megan", "Meghan", "Melanie", "Melissa", "Mia", "Michelle", "Mila", "Misty", "Monica", "Natalie", "Natasha", "Nicole", "Nora", "Olivia", "Patricia", "Penelope", "Peyton", "Rachel", "Reagan", "Rebecca", "Riley", "Rose", "Sadie", "Samantha", "Sandra", "Sara", "Sarah", "Savannah", "Scarlett", "Shannon", "Skyler", "Sophia", "Sophie", "Stacey", "Stacy", "Stella", "Stephanie", "Susan", "Tara", "Tiffany", "Tina", "Valerie", "Vanessa", "Veronica", "Victoria", "Violet", "Whitney", "Zoe"];
        return names[Math.floor(Math.random() * names.length)];
      }

      randomizeSurname(slave) {
        let surnames = ["Adams", "Allen", "Allred", "Anderson", "Avery", "Bailey", "Baker", "Barnes", "Beckstead", "Bell", "Bennett", "Bennion", "Benson", "Bingham", "Bradshaw", "Brooks", "Brown", "Burns", "Butler", "Campbell", "Carr", "Carter", "Christensen", "Clark", "Clooney", "Cole", "Coleman", "Collins", "Cook", "Cooper", "Cox", "Cunningham", "Davis", "DeMille", "Donaldson", "Edwards", "Ellis", "Evans", "Feldsted", "Fisher", "Forbush", "Foster", "Fox", "Frank", "Franklin", "Gardner", "Gibson", "Graham", "Gray", "Green", "Gubler", "Hall", "Hamilton", "Hancock", "Hanks", "Hansen", "Hardward", "Harris", "Hartvigsen", "Hatch", "Hayes", "Hill", "Howard", "Hughes", "Hymas", "Izatt", "Jackson", "Jacobs", "Jacobsen", "Jacobson", "James", "Jensen", "Johnson", "Jones", "Jorgensen", "Kelly", "Kennedy", "Kimball", "King", "Larsen", "Lauritzen", "Lee", "Lewis", "Long", "MacDonald", "Marks", "Martin", "McDonald", "Mecham", "Meyer", "Michaels", "Miller", "Mitchell", "Moore", "Morgan", "Morris", "Murphy", "Murray", "Myers", "Naegle", "Nelson", "Olsen", "Olson", "Orwell", "Parker", "Patterson", "Perry", "Peterson", "Phelps", "Phillips", "Pitt", "Powell", "Price", "Pulsipher", "Rasmussen", "Reed", "Reynolds", "Richardson", "Rigby", "Roberts", "Robinson", "Robison", "Rogers", "Romney", "Ross", "Roth", "Russell", "Sanders", "Schmidt", "Scott", "Shumway", "Smith", "Smoot", "Snyder", "Sorensen", "Spendlove", "Stevens", "Stewart", "Stone", "Sullivan", "Talbot", "Taylor", "Thomas", "Thompson", "Thomson", "Turley", "Turner", "Wagner", "Walker", "Wallace", "Ward", "Watson", "West", "White", "Willem", "Williams", "Wilson", "Wood", "Wright", "Yorgensen", "Young", "Zabriskie", "Zollinger"]
        return surnames[Math.floor(Math.random() * surnames.length)];
      }

      randomizeAge() {
        return Math.floor(Math.random() * 24) + 18;
      }

      _normalRandInt(nr) {
        return Math.floor(this._normalRand() * (nr + 1) / 3 + 0.5);
      }

      _normalRandClampedInt(nr) {
        return Math.min(Math.max(-nr, this._normalRandInt(nr)), nr);
      }

      _normalRand() {
        return Math.sqrt(-2 * Math.log(Math.random()))*Math.cos((2*Math.PI) * Math.random());
      }

      _randomElement(array) { return array[Math.floor(Math.random() * array.length)]; }

      _randomBoobVolume(mod) {
        let volume = [0, 300, 500, 650, 800, 1000, 1200, 1400, 1600, 1800, 2050, 2300, 2600, 2900, 3250, 3600, 3950, 4300, 4700, 5100, 5500, 5900];
        let volume_dist = [90000, 470000, 720000, 840000, 908574, 947759, 970151, 982946, 990258, 994436, 996824, 998188, 998968, 999414, 999669, 999814, 999897, 999945, 999972, 999987, 999995, 1000000];
        let randomRoll = Math.floor(Math.random() * 1000000) + 1;
        let actualSize = 0;
        while (randomRoll > volume_dist[actualSize]) {
          actualSize = actualSize + 1
        }
        let minorSizeAdjustment = 0;
        if (Math.random() < 0.5) {
          minorSizeAdjustment = (Math.floor(Math.random() * 2) + 1) * 50
        }
        let volResult = volume[actualSize] + minorSizeAdjustment + mod;
        if (volResult < 0) {volResult = 0}
        return volResult
      }
    }

    customElements.define(FCCreateSlaveData.is, FCCreateSlaveData);
  </script>
</dom-module>
