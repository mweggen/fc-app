<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/app-storage/app-localstorage/app-localstorage-document.html">

<dom-module id="fc-game-state">
  <template>
    <app-localstorage-document key="fc-game-state" data="{{gameState}}"></app-localstorage-document>
  </template>
  <script>
    class FCGameState extends Polymer.Element {
      static get is() {
        return 'fc-game-state';
      }

      static get properties() { return {
        gameState: {
          type: Object,
          value: () => ({
            slaves: [],
            canEndWeek: true
          }),
          notify: true
        },
        slaveReports: {
          type: Array,
          notify: true
        },
      }}

      ready() {
        super.ready();
      }

      endWeek() {
        console.info('running onEndWeek');
        this.set('slaveReports', []);
        for (let i = 0; i < this.gameState.slaves.length; i++) {
          let slave = this.gameState.slaves[i];
          let report = {};
          if (slave.assignment === 'whore') {
            report = this._whore(slave);
          } else {
            report = this._rest(slave);
          }
          this.push('slaveReports', report);
        }
        console.info(this.slaveReports);
      }

      _whore(slave) {

      }

      _rest(slave) {
        let report = {
          slave: JSON.parse(JSON.stringify(slave)),
          assignment: 'rest',
        };
        if (slave.health <= 90 && slave.health > -100) {
          slave.health += 10;
        }
        if (slave.fuckdoll === 0 && slave.fetish !== 'mindbroken') {
          if (slave.devotion > 20) {
            if (slave.trust <= 20) {
              slave.trust += 4;
            } else {
              slave.trust += 2;
            }
          } else if (slave.trust < -20) {
            slave.trust += 4;
          }
        }
        return report;
      }


      addSlave(slave) {
        console.info(slave);
        this.push('gameState.slaves', slave);
      }
    }

    customElements.define(FCGameState.is, FCGameState);
  </script>
</dom-module>
